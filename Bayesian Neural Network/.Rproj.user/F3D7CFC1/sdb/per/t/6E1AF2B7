{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Convergence Diagnostics\"\nauthor: \"Umbertol Junior Mele 1388371\"\ndate: \"29 settembre 2017\"\noutput: pdf_document\n---\n## Second case Neal priors\n\n\\centering\n\n#### Posterior marginal \n\n\n```{r, echo=FALSE}\nplot_and_find_the_mode <- function(sim, i =0, j=0, obj=''){\n  if(i == 0){\n    den <- density(sim[,,1])\n  }else if(j==0){\n    den <- density(sim[i,,1])\n  }else{\n    den <- density(sim[i,j,,1])\n  }\n  massimo <- den$x[which.max(den$y)]\n  if(obj=='Beta'){\n    lim <- net.1$weights[[1]][[2]][i,1]\n    plot(den, xlim=c(-abs(lim)-2,+ abs(lim)+2), main = paste('Beta',i) )\n    segments(massimo,0,y1=max(den$y), col='grey')\n    points(lim ,0, col='blue')\n  }\n  if(obj=='Beta.0'){\n    lim <- net.1$weights[[1]][[2]][(K+1),1]\n    plot(den, xlim=c(-abs(lim)-2,+ abs(lim)+2), main ='Beta0')\n    segments(massimo,0,y1=max(den$y), col='grey')\n    points(lim,0, col='blue')\n  }\n  if(obj=='Gamma'){\n    lim <- net.1$weights[[1]][[1]][j,i]\n    plot(den, xlim=c(-abs(lim)-2,+ abs(lim)+2),main = paste(paste('Gamma- neuron: ',i),\n                                                           paste(' -covariate: ', j)) )\n    segments(massimo,0,y1=max(den$y), col='grey')\n    points(lim,0, col='blue')\n  }\n  if(obj=='Gamma.0'){\n    lim <- net.1$weights[[1]][[1]][6,i]\n    plot(den, xlim=c(-abs(lim)-2,+ abs(lim)+2), main = paste('Gamma.0 Bias - neuron: ',i))\n    segments(massimo,0,y1=max(den$y), col='grey')\n    points(lim,0, col='blue')\n  }\n  return(massimo)\n}\n\nfind_maximum <- function(sim, i = 0, j=0){\n  if(i == 0){\n    den <- density(sim[,,1])\n  }else if(j==0){\n    den <- density(sim[i,,1])\n  }else{\n    den <- density(sim[i,j,,1])\n  }\n  massimo <- den$x[which.max(den$y)]\n  return(massimo)\n}\n\n```\n\n\n```{r, echo=FALSE, fig.height=10, fig.width=10}\nload('neal_chain3_for_15nuerons.RData')\nload('neal_chain4_for_15nuerons.RData')\nload('neal_chain_huge_chain.RData')\nload('data_simmulated_for_neal.RData')\nload('network_for_K_15_1000.RData')\n\n\nK <- 15\nsim <- sim_neal_huge\nsim1 <- sim_neal3\nsim2 <- sim_neal4\n\npar(mfrow=c(9,5), mar=c(2,2,1.5,2.5))\nfor(k in 1:K){\n  plot_and_find_the_mode(sim$Gamma.0,k, obj='Gamma.0')\n  for(p in c(1,3)){\n    plot_and_find_the_mode(sim$Gamma,k,p, obj='Gamma')\n  }\n}\n\n```\n\n```{r, echo=FALSE}\npar(mfrow=c(4,4), mar=c(2.5,2.5,1.5,1.5))\nplot_and_find_the_mode(sim$Beta.0, obj = 'Beta.0')\nfor(k in 1:K){\n  plot_and_find_the_mode(sim$Beta,k, obj = 'Beta')\n}\n```\n\n\\newpage\n\n#### Traceplot for marginals\n\n```{r, echo=FALSE, fig.height=10, fig.width=10}\n# Traceplots\npar(mfrow=c(2,4), mar=c(2.5,2.5,1.5,1.5))\nts.plot(sim$Beta[1,,], main='Beta 1')\nts.plot(sim$Beta.0[1,,], main='Beta 0')\nts.plot(sim$Gamma.0[2,,], main='Gamma 0 neur 2')\nts.plot(sim$Gamma[1,1,,], main='Gamma 1 neur 1')\nts.plot(cbind(sim1$Beta[1,,],sim2$Beta[1,,]), main='Beta 1')\nts.plot(cbind(sim1$Beta.0[1,,],sim2$Beta.0[1,,]), main='Beta 0')\nts.plot(cbind(sim1$Gamma.0[2,,],sim2$Gamma.0[2,,]), main='Gamma 0 neur 2')\nts.plot(cbind(sim1$Gamma[1,1,,],sim2$Gamma[1,1,,]), main='Gamma 1 neur 1')\n\n```\n\n\\newpage\n\n#### Traceplot for running means\n\n\n```{r, echo=FALSE, fig.height=10, fig.width=10}\n# running mean\npar(mfrow=c(2,4), mar=c(2.5,2.5,1.5,1.5))\ns1 <- sim$Beta[1,,]\ns2 <- sim$Beta.0[1,,]\ns3 <- sim$Gamma.0[2,,]\ns4 <- sim$Gamma[1,1,,]\n\nts.plot(cumsum(s1)/seq_along(s1))\nts.plot(cumsum(s2)/seq_along(s2))\nts.plot(cumsum(s3)/seq_along(s3))\nts.plot(cumsum(s4)/seq_along(s4))\n\n# running means two chains\n\ns1_1 <- sim1$Beta[1,,]\ns1_2 <- sim1$Beta.0[1,,]\ns1_3 <- sim1$Beta[2,,]\ns1_4 <- sim1$Gamma[1,1,,]\n\ns2_1 <- sim2$Beta[1,,]\ns2_2 <- sim2$Beta.0[1,,]\ns2_3 <- sim2$Beta[2,,]\ns2_4 <- sim2$Gamma[1,1,,]\n\nts.plot(cbind(cumsum(s1_1)/seq_along(s1_1),cumsum(s2_1)/seq_along(s2_1)))\nts.plot(cbind(cumsum(s1_2)/seq_along(s1_2),cumsum(s2_2)/seq_along(s2_2)))\nts.plot(cbind(cumsum(s1_3)/seq_along(s1_3),cumsum(s2_3)/seq_along(s2_3)))\nts.plot(cbind(cumsum(s1_4)/seq_along(s1_4),cumsum(s2_4)/seq_along(s2_4)))\n\n```\n\n\\newpage\n\n#### Autocorrelation and Auto-correlation\n\n\n```{r, echo=FALSE, fig.height=10, fig.width=10}\npar(mfrow=c(2,4), mar=c(2.5,2.5,1.5,1.5))\n# Auto-correlation functions\nacf(s1,lag.max = 10000)\nacf(s2,10000)\nacf(s3,10000)\nacf(s4,10000)\n\n\n# Cross-Corelation\nccf(s1, s2,10000)\nccf(s1, s3,10000)\nccf(s1, s4,10000)\n\n```\n\n\\newpage\n\n#### Spectral analysis\n\nUsing coda Geweke Convergence diagnostic, I have this result:\n\n\\centering\n\\begin{tabular}{rlll}\n  \\hline\n & chain & Z\\_score & p\\_value \\\\ \n  \\hline\n1 & Beta1 & -6.41 & 7.51e-11 \\\\ \n  2 & Beta0 & 2.92 & 0.0017 \\\\ \n  3 & gamma 2,1 & 4.31 & 8.058e-06 \\\\ \n  4 & gamma 1,2 & -4.14 & 1.715e-05 \\\\ \n   \\hline\n\\end{tabular}\n\n\nUsing coda Heidelberger and Welch Convergence diagnostic, I have this result:\n\n```{r, echo=FALSE}\nrequire(coda)\n\nheidel.diag(s1)\nheidel.diag(s2)\nheidel.diag(s3)\nheidel.diag(s4)\n```\n\n\n\\newpage\n\n#### Predictive Posterior distribution analysis\n\n```{r,echo=FALSE, fig.height=12, fig.width=10}\nind <- read.csv(file = \"muller_rois_index.txt\", sep = '\\t', header = F)\npar(mfrow=c(5,5), mar=c(2.5,2.5,1.5,2.5))\no <- sample(x =0:1000, size = 25)\nfor(i in 1:25){\n  l= 106+ o[i]\n  plot(density(sim$Y.rep[o[i],,1]),main = ind[l,1])\n  points(Y[o[i]],0,col='blue')\n  p <- mean(sim$Y.rep[o[i],,1]< Y[o[i]])\n  p_val <- min(p, 1-p)\n  legend('topleft',legend = bquote(p-value ~ \"=\" ~ .(p_val)),lty = 1:2, cex = 0.5)\n}\n\n```\n\n\n\n\n\\newpage\n\n#### visualizing the posterior log-likelihood\n\n```{r, echo=FALSE, fig.height=10, fig.width=10}\n# visualizing the posterior log-likelihood\npred_ind <- ind[1108:2107,1]\np.log <- colSums(sim$p.log[,,1])\nts.plot(p.log)\n\n```\n\n",
    "created" : 1506705049811.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2938198796",
    "id" : "6E1AF2B7",
    "lastKnownWriteTime" : 1506706500,
    "last_content_update" : 1506707026631,
    "path" : "C:/Users/Umbertojunior/Desktop/data science/Second Semestr/SDS 2/project/Bayesian Neural Network/presentation/plot_figure2.Rmd",
    "project_path" : "presentation/plot_figure2.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}